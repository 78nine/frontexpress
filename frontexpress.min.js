var frontexpress=function(){"use strict";function t(t,e){if(e.method&&e.method!==t.method)return!1;if(!e.uri||!t.uri)return!0;var r=/^(.*)\?.*#.*|(.*)(?=\?|#)|(.*[^\?#])$/.exec(t.uri),n=r[1]||r[2]||r[3];if(e.uri instanceof RegExp)return null!==n.match(e.uri);if(-1!==e.uri.indexOf(":")){for(var i=function(t){return!isNaN(parseFloat(t))&&isFinite(t)?Number.isInteger(t)?Number.parseInt(t,10):Number.parseFloat(t):t},o=[],a=/:([^\/\?]+)\??/g,u=a.exec(e.uri);null!=u;)o.push(u[1]),u=a.exec(e.uri);var s=e.uri.replace(/\/:[^\/]+\?/g,"(?:/([^/]+))?").replace(/:[^\/]+/g,"([^/]+)").replace("/","\\/"),f=n.match(new RegExp("^"+s+"$"));return!!f&&(t.params=Object.assign(t.params,o.reduce(function(t,e,r){var n=f[r+1];return n&&(n=-1!==n.indexOf(",")?n.split(",").map(function(t){return i(t)}):n=i(n)),t[e]=n,t},{})),!0)}return e.uri===n}function e(t,e){if("function"!=typeof t)throw new TypeError(e)}function r(t){if(!t||!t.uri&&!t.headers&&!t.data)throw new TypeError("setting http transformer one of functions: uri, headers, data is missing")}function n(t){var e,r,n,i,o=void 0,a=void 0,u=void 0,f=void 0,c=void 0;return 1===t.length?(e=t,r=s(e,1),c=r[0]):(n=t,i=s(n,2),o=i[0],c=i[1]),c instanceof d?u=c:c instanceof h||"function"==typeof c?a=c:c&&c.plugin&&"function"==typeof c.plugin&&(f=c),{baseUri:o,middleware:a,router:u,plugin:f,which:c}}var i=["GET","POST","PUT","PATCH","DELETE"],o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=function(){function t(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},h=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";a(this,t),this.name=e}return u(t,[{key:"entered",value:function(t){}},{key:"exited",value:function(t){}},{key:"updated",value:function(t,e){}},{key:"failed",value:function(t,e){}},{key:"next",value:function(){return!0}}]),t}(),c=function(){function t(e,r,n,i){a(this,t),this.router=e,this.uriPart=r,this.method=n,this.middleware=i,this.visited=!1}return u(t,[{key:"uri",get:function(){if(this.uriPart||this.method){if(this.uriPart instanceof RegExp)return this.uriPart;if(this.router.baseUri instanceof RegExp)return this.router.baseUri;if(this.router.baseUri){var t=this.router.baseUri.trim();return this.uriPart?(t+this.uriPart.trim()).replace(/\/{2,}/,"/"):t}return this.uriPart}}}]),t}(),d=function(){function t(e){a(this,t),this._baseUri=e,this._routes=[]}return u(t,[{key:"_add",value:function(t){return this._routes.push(t),this}},{key:"routes",value:function(t,e){e.params=e.params||{};var r=t.get("route matcher");return this._routes.filter(function(t){return r(e,t)})}},{key:"visited",value:function(){return this._routes.filter(function(t){return t.visited})}},{key:"use",value:function(t){if(!(t instanceof h)&&"function"!=typeof t)throw new TypeError("method takes at least a middleware");return this._add(new c(this,void 0,void 0,t)),this}},{key:"all",value:function(){for(var t=this,e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];if(!n(r).middleware)throw new TypeError("method takes at least a middleware");return i.forEach(function(e){t[e.toLowerCase()].apply(t,r)}),this}},{key:"baseUri",set:function(t){if(t)if(this._baseUri){if(o(this._baseUri)!==(void 0===t?"undefined":o(t)))throw new TypeError("router cannot mix regexp and uri")}else this._baseUri=t},get:function(){return this._baseUri}}]),t}();i.forEach(function(t){var e=t.toLowerCase();d.prototype[e]=function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];var o=n(r),a=o.baseUri,u=o.middleware;if(!u)throw new TypeError("method takes at least a middleware");if(a&&this._baseUri&&this._baseUri instanceof RegExp)throw new TypeError("router cannot mix uri/regexp");return this._add(new c(this,a,t,u)),this}});var l=function(){function t(){a(this,t)}return u(t,[{key:"fetch",value:function(t,e,r){var n=t.method,i=t.uri,o=t.headers,a=t.data,u=function(r){e(t,{status:200,statusText:"OK",responseText:r})},s=function(e){var n=e.status,i=e.statusText,o=e.errorThrown;r(t,{status:n,statusText:i,errorThrown:o,errors:"HTTP "+n+" "+(i||"")})},f=new XMLHttpRequest;f.onreadystatechange=function(){4===f.readyState&&(200===f.status?u(f.responseText):s({status:f.status,statusText:f.statusText}))};try{f.open(n,i,!0),o&&Object.keys(o).forEach(function(t){f.setRequestHeader(t,o[t])}),a?f.send(a):f.send()}catch(t){s({errorThrown:t})}}}]),t}(),p={uri:function(t){var e=t.uri,r=(t.headers,t.data);if(!r)return e;var n=e,i="";if(/^(.*)(#.*)$/.exec(e)){var o=/^(.*)(#.*)$/.exec(e),a=s(o,3);n=a[1],i=a[2]}return n+(-1===n.indexOf("?")?"?":"&")+y(r)+i}},y=function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e instanceof Object?(Object.keys(e).forEach(function(i){var o=new(Function.prototype.bind.apply(Array,[null].concat(f(r))));o.push(i),t(e[i],o,n)}),n.join("&")):r.length>0?void n.push(""+encodeURIComponent(r[0])+r.slice(1).map(function(t){return encodeURIComponent("["+t+"]")}).join("")+"="+encodeURIComponent(e)):"string"==typeof e?e.split("").map(function(t,e){return e+"="+encodeURIComponent(t)}).join("&"):""},v={data:function(t){var e=t.data;return e?y(e):e},headers:function(t){t.uri;var e=t.headers,r=(t.data,e||{});return r["Content-Type"]||(r["Content-Type"]="application/x-www-form-urlencoded"),r}},w=function(){function n(){a(this,n),this.settings={"http requester":new l,"http GET transformer":p,"http POST transformer":v,"http PATCH transformer":v,"route matcher":t},this.rules={"http requester":function(t){e(t.fetch,"setting http requester has no fetch function")},"http GET transformer":function(t){r(t)},"http POST transformer":function(t){r(t)},"http PATCH transformer":function(t){r(t)},"route matcher":function(t){e(t,"setting route matcher is not a function")}}}return u(n,[{key:"set",value:function(t,e){var r=this.rules[t];r&&r(e),this.settings[t]=e}},{key:"get",value:function(t){return this.settings[t]}}]),n}(),m=function(){function t(){a(this,t),this.routers=[],this.settings=new w,this.plugins=[]}return u(t,[{key:"set",value:function(){for(var t,e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return 1===r.length?this.settings.get([r]):((t=this.settings).set.apply(t,r),this)}},{key:"listen",value:function(t){var e=this,r={method:"GET",uri:window.location.pathname+window.location.search},n={status:200,statusText:"OK"},i=this._routes(r);this._callMiddlewareMethod("entered",i,r),window.onpopstate=function(t){if(t.state){var r=t.state,n=r.request,i=r.response;["exited","entered","updated"].forEach(function(t){return e._callMiddlewareMethod(t,e._routes(n),n,i)})}},window.onbeforeunload=function(){e._callMiddlewareMethod("exited")};var o=function(){e.plugins.forEach(function(t){return t.plugin(e)}),e._callMiddlewareMethod("updated",i,r,n),t&&t(r,n)};document.onreadystatechange=function(){"interactive"===document.readyState&&o()},-1!==["interactive","complete"].indexOf(document.readyState)&&o()}},{key:"route",value:function(t){var e=new d(t);return this.routers.push(e),e}},{key:"use",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];var o=n(e),a=o.baseUri,u=o.router,s=o.middleware,f=o.plugin;if(f)this.plugins.push(f);else{if(u)u.baseUri=a;else{if(!s)throw new TypeError("method takes at least a middleware or a router");u=new d(a),i.forEach(function(t){u[t.toLowerCase()](s)})}this.routers.push(u)}return this}},{key:"_routes",value:function(t){var e=this;return this.routers.reduce(function(r,n){return r.push.apply(r,f(n.routes(e,t))),r},[])}},{key:"_callMiddlewareMethod",value:function(t,e,r,n){"exited"!==t?e.some(function(e){if("updated"===t&&(e.visited=r),e.middleware[t]){if(e.middleware[t](r,n),e.middleware.next&&!e.middleware.next())return!0}else if("entered"!==t){var i=!0,o=function(){i=!1};if(e.middleware(r,n,o),i)return!0}return!1}):this.routers.forEach(function(t){t.visited().forEach(function(t){t.middleware.exited&&(t.middleware.exited(t.visited),t.visited=null)})})}},{key:"_fetch",value:function(t,e,r){var n=this,i=t.method,o=t.uri,a=t.headers,u=t.data,s=t.history,f=this.get("http "+i+" transformer");if(f){var h=f.uri,c=f.headers,d=f.data;t.uri=h?h({uri:o,headers:a,data:u}):o,t.headers=c?c({uri:o,headers:a,data:u}):a,t.data=d?d({uri:o,headers:a,data:u}):u}this._callMiddlewareMethod("exited");var l=this._routes(t);this._callMiddlewareMethod("entered",l,t),this.settings.get("http requester").fetch(t,function(t,r){s&&window.history.pushState({request:t,response:r},s.title,s.uri),n._callMiddlewareMethod("updated",l,t,r),e&&e(t,r)},function(t,e){n._callMiddlewareMethod("failed",l,t,e),r&&r(t,e)})}}]),t}();i.reduce(function(t,e){var r=e.toLowerCase();return t[r]=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var o=n(e),a=o.baseUri,u=o.middleware,s=o.which;if("get"===r&&"string"==typeof s)return this.settings.get(s);if(!u)throw new TypeError("method takes a middleware "+("get"===r?"or a string":""));var f=new d;return f[r](a,u),this.routers.push(f),this},t["http"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()]=function(t,r,n){var i=t.uri,o=t.headers,a=t.data,u=t.history;return i||(i=t),this._fetch({uri:i,method:e,headers:o,data:a,history:u},r,n)},t},m.prototype);var g=function(){return new m};return g.Router=function(t){return new d(t)},g.Middleware=h,g}();
//# sourceMappingURL=frontexpress.min.js.map
